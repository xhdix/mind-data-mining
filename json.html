<!DOCTYPE html>
<html>
<head >
    <meta charset="utf-8">
    <title>ooni json</title>
    <style>

    </style>
    <script>
        async function addInputsWithIp (url, hostName) {
            var response = await fetch('https://dns.google/resolve?name='
            + hostName );
            var json = await response.json();
            console.log(json);
            try {
                answers = json["Answer"];
                for (let i = 0; i < answers.length; i++) {
                    ip = answers[i]["data"];
                    inputs.innerHTML += '<textarea rows="3" cols="100" class="input">' 
                        + '{"name": "dnscheck", "input": "'
                        + url.replace(hostName,ip)
                        + '", "dns_check":{"domain": "x.org", "http_host": "'
                        + hostName
                        + '", "tls_server_name": "'
                        + hostName
                        + '"}}'
                        + '</textarea><br><br>';
                }
            }catch(e) {
                console.log("answer for:" + hostName,  e.message);
            }
        };

        async function addinputs(url){
            thisurl = new URL(url);
            proto = thisurl.protocol;
            console.log(proto);
            matches = url.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);
            hostName = matches && matches[3];
            console.log(hostName);
            if ( proto == 'https:' || proto == 'http3:' || proto == 'dot:' ) {
                if (RegExp("^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$").test(hostName)) {
                    inputs.innerHTML += '<textarea rows="3" cols="100" class="input">' 
                        + '{"name": "dnscheck", "input": "'
                        + url 
                        + '", "dns_check":{"domain": "x.org"}}'
                        + '</textarea><br><br>'; 
                }else {
                    inputs.innerHTML += '<textarea rows="3" cols="100" class="input">' 
                        + '{"name": "dnscheck", "input": "'
                        + url 
                        + '", "dns_check":{"domain": "x.org", "http_host": "'
                        +  hostName
                        + '"}}'
                        + '</textarea><br><br>';
                    
                    await addInputsWithIp(url, hostName);
                }
                
            }else {
                inputs.innerHTML += '<textarea rows="3" cols="100" class="input">' 
                    + '{"name": "dnscheck", "input": "'
                    + url 
                    + '", "dns_check":{"domain": "x.org"}}'
                    + '</textarea><br><br>'; 
            }
        };

        function parseurls (urlslist) {
            urlslist.forEach( async (url) => {
                if (url != "" ){
                    await addinputs(url);
                }
            });
        }

        function pasteurl(t,e) {
            urlslist = (e.clipboardData || window.clipboardData)
                .getData('text')
                .replace(/^(?=\n)$|^\s*|\s*$|\n\n+/gm,"")
                .split(/\r\n|\r|\n/g);
            console.log(urlslist);
            parseurls(urlslist);
            e.preventDefault();
            t.innerText = "well done :D"
        };
    </script>
</head>
<body>
    
<div>
    <div id="inputs">
        <p contenteditable="true" onPaste="pasteurl(this,event)" > \o/ paste here...</p>
        <br><br>
        <!-- <input class="input" vol=3 value=""/> -->
        <!-- <textarea rows="3" cols="100" class="input"></textarea> -->
    </div>
    <br>
    <button name="generate" onclick="generateoutput()">generate</button>
    <br><br>
    <p id="output" contenteditable="true" style="visibility:hidden;"></p>
    <br><br>
</div>
<script>
    function generateoutput() {
        outputText = "";
        output.innerText = "";
        output.style.visibility= "visible";
        let textareas = inputs.getElementsByTagName("textarea");
        for (let textarea of textareas) {
            outputText += textarea.value;
            outputText +=  "\n";
            output.innerText = outputText;
        }

    }

</script>

</body>
</html><!DOCTYPE html>
<html>
<head >
    <meta charset="utf-8">
    <title>ooni json</title>
    <style>

    </style>
    <script>
        async function addInputsWithIp (url, hostName) {
            var response = await fetch('https://dns.google/resolve?name='
            + hostName );
            var json = await response.json();
            console.log(json);
            try {
                answers = json["Answer"];
                for (let i = 0; i < answers.length; i++) {
                    ip = answers[i]["data"];
                    inputs.innerHTML += '<textarea rows="3" cols="100" class="input">' 
                        + '{"name": "dnscheck", "input": "'
                        + url.replace(hostName,ip)
                        + '", "dns_check":{"domain": "x.org", "http_host": "'
                        + hostName
                        + '", "tls_server_name": "'
                        + hostName
                        + '"}}'
                        + '</textarea><br><br>';
                }
            }catch(e) {
                console.log("answer for:" + hostName,  e.message);
            }
        };

        async function addinputs(url){
            thisurl = new URL(url);
            proto = thisurl.protocol;
            console.log(proto);
            matches = url.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);
            hostName = matches && matches[3];
            console.log(hostName);
            if ( proto == 'https:' || proto == 'http3:' || proto == 'dot:' ) {
                if (RegExp("^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$").test(hostName)) {
                    inputs.innerHTML += '<textarea rows="3" cols="100" class="input">' 
                        + '{"name": "dnscheck", "input": "'
                        + url 
                        + '", "dns_check":{"domain": "x.org"}}'
                        + '</textarea><br><br>'; 
                }else {
                    inputs.innerHTML += '<textarea rows="3" cols="100" class="input">' 
                        + '{"name": "dnscheck", "input": "'
                        + url 
                        + '", "dns_check":{"domain": "x.org", "http_host": "'
                        +  hostName
                        + '"}}'
                        + '</textarea><br><br>';
                    
                    await addInputsWithIp(url, hostName);
                }
                
            }else {
                inputs.innerHTML += '<textarea rows="3" cols="100" class="input">' 
                    + '{"name": "dnscheck", "input": "'
                    + url 
                    + '", "dns_check":{"domain": "x.org"}}'
                    + '</textarea><br><br>'; 
            }
        };

        function parseurls (urlslist) {
            urlslist.forEach( async (url) => {
                if (url != "" ){
                    await addinputs(url);
                }
            });
        }

        function pasteurl(t,e) {
            urlslist = (e.clipboardData || window.clipboardData)
                .getData('text')
                .replace(/^(?=\n)$|^\s*|\s*$|\n\n+/gm,"")
                .split(/\r\n|\r|\n/g);
            console.log(urlslist);
            parseurls(urlslist);
            e.preventDefault();
            t.innerText = "well done :D"
        };
    </script>
</head>
<body>
    
<div>
    <div id="inputs">
        <p contenteditable="true" onPaste="pasteurl(this,event)" > \o/ paste here...</p>
        <br><br>
        <!-- <input class="input" vol=3 value=""/> -->
        <!-- <textarea rows="3" cols="100" class="input"></textarea> -->
    </div>
    <br>
    <button name="generate" onclick="generateoutput()">generate</button>
    <br><br>
    <p id="output" contenteditable="true" style="visibility:hidden;"></p>
    <br><br>
</div>
<script>
    function generateoutput() {
        outputText = "";
        output.innerText = "";
        output.style.visibility= "visible";
        let textareas = inputs.getElementsByTagName("textarea");
        for (let textarea of textareas) {
            outputText += textarea.value;
            outputText +=  "\n";
            output.innerText = outputText;
        }

    }

</script>

</body>
</html>
